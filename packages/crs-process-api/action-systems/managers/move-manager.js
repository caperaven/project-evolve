import{getMouseInputMap as l,clientX as n,clientY as o}from"./input-mapping.js";class r extends crs.classes.Observable{#t;#m;#l;#a;#u;#n;#i;#o;#r=this.#c.bind(this);#e;#h;#s;constructor(t,i,s){super(),this.#t=t,this.#n=i,this.#m=s,this.#l=this.#p.bind(this),this.#a=this.#v.bind(this),this.#u=this.#f.bind(this),this.#t.style.position="fixed",this.#t.style.left=0,this.#t.style.top=0,this.#s=l(),this.#t.addEventListener(this.#s.mousedown,this.#l,{passive:!1}),t.__moveManager=this,s!=null&&this.addEventListener("moved",s)}dispose(){this.removeEventListener("moved",this.#m),this.#t.removeEventListener(this.#s.mousedown,this.#l),this.#l=null,this.#a=null,this.#u=null,this.#n=null,this.#i=null,this.#o=null,this.#s=null,this.#r=null,this.#e=null,this.#h=null,delete this.#t.__moveManager,this.#t=null,super.dispose()}#d(t){const i=t.composedPath(),s=i[0];return this.#n==null?s===this.#t:s.matches(this.#n)?!0:i.find(h=>h.matches&&h.matches(this.#n))!=null}async#p(t){this.#d(t)!==!1&&(this.#i={x:n(t),y:o(t)},this.#o=this.#t.getBoundingClientRect(),this.#t.style.willChange="translate",document.addEventListener(this.#s.mousemove,this.#a,{passive:!1}),document.addEventListener(this.#s.mouseup,this.#u,{passive:!1}),this.#r(),t.preventDefault(),t.stopPropagation())}async#c(){this.#i!=null&&(this.#e||=0,this.#h||=0,this.#t.style.left=0,this.#t.style.top=0,this.#t.style.translate=`${this.#o.x+this.#e}px ${this.#o.y+this.#h}px`,requestAnimationFrame(this.#r))}async#v(t){this.#e=n(t)-this.#i.x,this.#h=o(t)-this.#i.y,t.preventDefault(),t.stopPropagation()}async#f(t){const i=this.#e,s=this.#h,e=this.#t;document.removeEventListener(this.#s.mousemove,this.#a),document.removeEventListener(this.#s.mouseup,this.#u),this.#i=null,this.#o=null,this.#e=null,this.#h=null,t.preventDefault(),t.stopPropagation(),this.notify("moved",{element:e,x:i,y:s})}}export{r as MoveManager};
